<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Proxmox Cluster with QDevice & Data Center Manager</title>
  <link rel="icon" type="image/x-icon" href="image/favicon.ico">
  <link rel="stylesheet" href="Blog_Post.css">
  <!-- Social Embed -->
<meta property="og:title" content="Holden Weber – IT Blog">
<meta property="og:description" content="Networking, Linux, automation, and home lab writeups.">
<meta property="og:image" content="https://graphicalnetworks.com/wp-content/uploads/2018/06/logical-network-diagram-example.png">
<meta property="og:url" content="https://holdenweber.com/">
<meta property="og:type" content="website">

<meta name="twitter:card" content="https://graphicalnetworks.com/wp-content/uploads/2018/06/logical-network-diagram-example.png">

</head>
<body>
  <div id="mySidenav" class="sidenav">
    <a href="index.html">Home</a>
    <a href="Blog.html">Blog</a>
    <a href="about.html">About Me</a>
    <a href="Holden_Weber_Resume.html">Resume</a>
  </div>

 <!-- Hamburger Menu -->
  <span onclick="openNav()">
    <div class="hamburger" id="hamburger">
      <div class="line"></div>
      <div class="line"></div>
      <div class="line"></div>
    </div>
  </span>

<body>

  <h1>Introduction</h1>
  <p>I am setting up another Proxmox server and making a cluster with my current one. I will then install and setup Proxmox Data Center to have a dashboard to view my Proxmox environment.</p>

  <h1>Setting up the Cluster</h1>

  <h2>Main Node Config</h2>
  <p>On the main node, you will want to create the cluster. In order to do that, run the command:</p>
  <pre>pvecm create homelab</pre>
  <p>It will show something like this:</p>
  <img src="/images/proxmox_cluster_qdevice_datacenter_manager/image1.jpg" alt="Cluster creation output">

  <p>To confirm that it was created properly, send the command:</p>
  <pre>pvecm status</pre>
  <p>This will show only one node (your primary):</p>
  <img src="/images/proxmox_cluster_qdevice_datacenter_manager/image2.png" alt="Primary node status">

  <h2>Node 2 Config</h2>
  <p>Since Node 1 created the cluster, you will need to join node 2 to it. While accessing the CLI of node 2, run the command (replace 172.16.1.24 with your primary node IP):</p>
  <pre>pvecm add 172.16.1.24</pre>
  <p>You should see "Successfully added node 'pve2' to cluster."</p>
  <img src="/images/proxmox_cluster_qdevice_datacenter_manager/image3.png" alt="Node 2 join output">

  <p>To verify, run:</p>
  <pre>pvecm nodes</pre>
  <p>You should see both your primary and secondary nodes with their names.</p>
  <img src="/images/proxmox_cluster_qdevice_datacenter_manager/image4.jpg" alt="Cluster nodes list">

  <h2>QDevice Specs</h2>
  <p>With only 2 nodes in the cluster, if one goes down, your remaining node will not hold quorum. To bypass this, create a QDevice. This can be a VM, Raspberry Pi, or another computer. Specs don’t need to be high.</p>
  <p>Example VM on my Ugreen NAS:</p>
  <ul>
    <li>Cores: 1</li>
    <li>RAM: 1 GB</li>
    <li>Storage: 6 GB</li>
    <li>OS: Debian 12</li>
  </ul>

  <h2>QDevice Config</h2>
  <p>Set a static IP for the QDevice. Edit:</p>
  <pre>nano /etc/network/interfaces</pre>
  <p>Add your preferred IP, gateway, and DNS servers:</p>
  <img src="/images/proxmox_cluster_qdevice_datacenter_manager/image5.png" alt="Static IP config">

  <p>Install corosync:</p>
  <pre>apt install corosync-qnetd -y</pre>

  <p>Adjust SSH settings on the QDevice and Proxmox nodes:</p>
  <pre>nano /etc/ssh/sshd_config</pre>
  <p>Uncomment and set:</p>
  <pre>
PermitRootLogin yes
PasswordAuthentication yes
  </pre>

  <p>Install corosync qdevice on both Proxmox nodes:</p>
  <pre>apt install corosync-qdevice -y</pre>
  <p>Set up QDevice on one node:</p>
  <pre>pvecm qdevice setup 172.16.1.50</pre>

  <p>Check cluster status:</p>
  <pre>pvecm status</pre>
  <p>If "expected votes: 3" appears, quorum is maintained.</p>
  <img src="/images/proxmox_cluster_qdevice_datacenter_manager/image2.png" alt="Cluster status with QDevice">

  <p>In the Proxmox web UI (Datacenter &gt; Cluster), you will see your two Proxmox nodes (QDevice is not visible as it is not a Proxmox server):</p>
  <img src="/images/proxmox_cluster_qdevice_datacenter_manager/image5.png" alt="Proxmox nodes in web UI">

  <h1>Setting up Data Center Manager</h1>
  <p>Download the datacenter ISO here: <a href="https://www.proxmox.com/en/downloads/proxmox-datacenter-manager">Proxmox Data Center Manager</a></p>

  <h2>Install Data Center Manager</h2>
  <p>Install DCM on a VM with better specs than the QDevice:</p>
  <ul>
    <li>Cores: 2</li>
    <li>RAM: 4 GB</li>
    <li>Disk: 40 GB</li>
    <li>OS: Proxmox DCM</li>
  </ul>
  <p>Access it at: <a href="http://your-ip:8443">http://your-ip:8443</a></p>

  <h2>Linking with your Cluster</h2>
  <p>Login to the DCM web UI, then go Remotes &gt; Add &gt; Proxmox VE. Enter server IP and port (e.g., 172.16.1.24:8006).</p>
  <img src="/images/proxmox_cluster_qdevice_datacenter_manager/image13.png" alt="Add Proxmox remote">

  <p>Click Next &gt; Use Existing Token</p>

  <h3>Creating a Token</h3>
  <p>On the primary node: Datacenter &gt; Permissions &gt; API Tokens &gt; Add. Name your token under Token ID, uncheck Privilege Separation, click Add.</p>
  <img src="/images/proxmox_cluster_qdevice_datacenter_manager/image14.png" alt="Create API token">

  <p>Copy the Token ID and Secret to use in DCM:</p>
  <img src="/images/proxmox_cluster_qdevice_datacenter_manager/image9.png" alt="Token ID and Secret">

  <p>Paste Token ID under Token and Secret under Secret in DCM. Give the Remote ID a value.</p>
  <img src="/images/proxmox_cluster_qdevice_datacenter_manager/image10.png" alt="DCM remote setup">

  <p>Click Next. Adjust hostnames/IPs if needed, then finish the summary.</p>
  <img src="/images/proxmox_cluster_qdevice_datacenter_manager/image7.png" alt="DCM summary">

  <h2>Accessing Dashboard</h2>
  <p>Go Remotes &gt; PVE to view nodes info:</p>
  <img src="/images/proxmox_cluster_qdevice_datacenter_manager/image3.png" alt="DCM dashboard">

  <p>Click dashboard to see the full Data Center Manager dashboard.</p>

</body>
</html>